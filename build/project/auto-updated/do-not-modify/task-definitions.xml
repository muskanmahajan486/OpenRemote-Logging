<?xml version="1.0" encoding="UTF-8"?>

<!--
  OpenRemote, the Home of the Digital Home.
  Copyright 2008-2014, OpenRemote Inc.

  See the contributors.txt file in the distribution for a
  full listing of individual contributors.

  This program is free software; you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as
  published by the Free Software Foundation; either version 3 of the
  License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program; if not, see <http://www.gnu.org/licenses/>.
-->

<!--
 |  Customized and prefixed task definitions.
 |
 |  Author: Juha Lindfors
 +-->
<project name = "OpenRemote Project Task Definitions" basedir = "."
         xmlns:internal = "namespace://build.repository.openremote.org/project/tasks/internal">

  <property file = "default.properties"/>

  <!--
   | INTERNAL TASK DEFINITIONS
   |
   | Used as helper definitions but should not be used directly. In URI namespace
   | namespace://build.repository.openremote.org/project/tasks/internal
   +-->

  <!-- Internal configuration for Javac that can be shared with all compile related tasks... -->

  <presetdef name = "compile" uri = "namespace://build.repository.openremote.org/project/tasks/internal">
    <javac
      encoding = "UTF-8"
      target   = "1.6"
      debug    = "true"
      includeantruntime = "false"
      listfiles = "true"/>
  </presetdef>

  <!-- Internal definitions for TestNG tasks... -->

  <taskdef resource = "testngtasks" uri = "namespace://build.repository.openremote.org/project/tasks/internal"
           classpath = "${build.lib.dir}/testng-6.8/testng-6.8.jar"/>


  <!--
   | PUBLIC TASK DEFINITIONS
   |
   | Intended for use in the project template. In URI namespace
   | namespace://build.repository.openremote.org/project/tasks
   +-->


  <!-- A public, fixed definition for compiling the full source tree under the default Java
       source directory. -->

  <presetdef name = "compile-java" uri = "namespace://build.repository.openremote.org/project/tasks">

    <internal:compile
            srcdir = "${java.src.dir}"
            destdir = "${classes.dir}"/>

  </presetdef>


  <!--  A public, fixed definition for compiling the full Java unit test source tree. -->

  <presetdef name = "compile-java-unit-test" uri = "namespace://build.repository.openremote.org/project/tasks">

    <internal:compile
            srcdir  = "${test.src.dir}/java"
            destdir = "${test.classes.dir}"
            classpathref = "java.test.compile.classpath"/>

  </presetdef>



  <!-- A public, fixed definition for executing Java unit tests... -->

  <macrodef name = "run-java-unit-test" uri = "namespace://build.repository.openremote.org/project/tasks">

    <sequential>
      <internal:testng
              classpathref = "java.test.run.classpath"
              outputDir = "${unit.test.report.dir}"
              failureProperty = "java.unit.test.failure"
              suitename = "${project.name} Tests">
              
        <classfileset dir = "${test.classes.dir}" includes = "**/*.class"/>

      </internal:testng>
    </sequential>

  </macrodef>


  <!--
   |  PATH DEFINITIONS.
   |
   +-->


  <!--
   | Classpath to compile Java unit tests. Includes the compiled project classes and
   | TestNG framework libraries.
   +-->
  <path id = "java.test.compile.classpath">

    <!-- Compiled project classes... -->
    <pathelement path = "${classes.dir}"/>

    <!-- TestNG classes... -->
    <pathelement path = "${build.lib.dir}/testng-6.8/testng-6.8.jar"/>

  </path>

  <!--
   | Classpath required to execute Java unit test suite.
   +-->
  <path id = "java.test.run.classpath">

    <!-- All classes required to compile tests... -->
    <path refid = "java.test.compile.classpath"/>

    <!-- Compiled Java unit test classes -->
    <pathelement path = "${test.classes.dir}"/>

  </path>

</project>

